# 02 추론통계

## 1. 데이터 결측값 처리

통계학을 이용해 모집단의 특성을 추측하는 통계적 추론은 추정(estimation)과 가설검정(testing hypothesis)으로 나누어진다.

- 추정(estimation): 표본을 통해 모집단 특성을 추측하는 과정
- 가설검정(testing hypothesis): 모집단에 대한 추정과 관련해 표본이 가진 정보를 이용해 가설의 옳고 그름 여부를 판단하는 과정

<br><br>

## 2. 점추정(Point Estimate)

모평균, 모표준편차 같은 모수에 대한 추정치를 이에 대응하는 통계량으로 추정하는 것이다.

### 1) 추정량의 선택기준

#### (1) 불편성(unbiasedness)

**표본통계량의 기댓값이 모수의 실제값과 같을 때** 이 추정량은 불편성을 갖는다.
$$
E(\hat{\theta}) = \theta ~~~~(\hat{\theta}=\text{모수의 추정값}, ~~\theta=\text{모수})
$$
<br>

#### (2) 효율성(Efficency)

추정량 중에서 **분산이 가장 작은 추정량이 가장 효율적이다.**

즉, a, b 두 추정량이 모두 불편성을 갖는다고 하더라도, a가 b보다 분산이 작으면 a 추정량이 더 효울적이라고 말할 수 있다.

**분산이 작다는 것은 편차가 작다는 의미이고, 이는 평균으로 집중된다**라는 해석으로 이어지므로 추정량의 분산이 더 작은것이 더 유효하다고 판단할 수 있다.

- **최소분산불편추정량(MVUE: Minimum Variance Unbiased Estimator)**: 모든 불편추정량 중 가장 작은 분산을 갖는 추정량

<br>

#### (3) 일치성(Consistency)

**표본크기가 증가할수록 추정량이 모수에 근접**하게 된다.

<br>

#### (4) 충분성(Sufficiency)

**추정량이 모수에 대해 가장 많은 정보를 제공할 때** 그 추정량은 충분추정량이 된다.

<br>

### 2) 점추정량(Point Estimator)

**모집단의 특성을 단일값으로 추정한 값**을 점추정량이라고 한다.

대표적 점추정량으로는 표본평균, 표본분산 등이 있고, 중앙값 또한 추정량으로 사용되기도 한다.

점추정의 방법으로는 **적률방법(Moment Method)과 최대우도추정법(Maximum Likelihood Function Method)**이 있다.

<br>

### 3) 적률방법(Moment Method)

#### (1) 적률(Moment)

**모집단의 평균이 표본평균과 일치하는 모수 $\theta$를 찾는 방법**으로, 일반적으로 표본평균값이 모수에 대한 점추정 값이 된다. 

양수 n에 대해 확률변수 $X^n$의 기댓값 $E(X^n)$을 확률변수 X의 **원점에 대한 n차 적률**이라고 한다.
$$
\mu_n = E(X^n)\\\\
E(X^n) = \cases{
\sum X^n f(x) ~~~~~~~~: \text{이산확률변수}\\\\
\int^{\infty}_{-\infty}X^nf(x)dx~ :  \text{연속확률변수}
}\\\\
f(x)\text{는 확률질량함수 또는 확률밀도함수}
$$
<br>

#### (2) 표본평균을 이용한 모수(평균)의 점추정 시 적률에 의한 방법

확률밀도함수가 $f(x; \theta_1, \theta_2, \cdots, \theta_m)$인 모집단으로부터 추출한 n개의 표본을 $X_1, X_2, \cdots, X_{n-1}, X_n$이라 하면, 모수 $\theta_1, \theta_2, \cdots, \theta_m$의 원점에 대한 k차 적률은 다음과 같다.
$$
E(X^n) = \int^\infty_{-\infty}X^k f(x; \theta_1, \theta_2, \cdots, \theta_m)dx
$$
이는 n개의 표본 각각에 대해 계산된 $X^k$의 기댓값이므로 하나의 모수에 대한 추정값은 다음과 같고(표본평균),
$$
M_k = \frac{1}{n}\sum^n_{i=1}x_i^k = \frac{1}{n}(x_1^k + x_2^k + \cdots + x_n^k)
$$
m개의 모수가 있다면 n개의 표본으로부터 m개의 적률을 통해 전체 모수 추정값을 얻게 된다.
$$
E(X) = M_1, E(X^2) = M_2, \cdots, E(X^n) = M_m
$$
<br>

### 4) 편향

편향이란 기대하는 추정량과 실제 모수 값의 차이이다 표본에서 얻어낸 추정량은 모수에 가까울수록, 즉 편향이 작을 수록 좋다.

임의의 추정량이 가진 편향을 $B(\hat{\theta})$라고 하면 $B(\hat{\theta})= E(\hat{\theta}) - \theta$이다.

이에 따라 불편추정량은 $B(\hat{\theta}) = 0$으로 표현될 수 있다.

**표본평균은 불편추정량이나, 표본분산은 불편추정량이 아니다.*

<br>

### 5) 평균제곱오차(MSE: Mean Squared Error)

**평균제곱오차는 점추정량과 모수값의 차이의 제곱에 대한 기댓값**으로 정의하고, 아래와 같이 나타낸다.
$$
MSE(\hat{\theta}) = E[(\hat{\theta} - \theta)^2]
$$
<br>

### 6) 최대우도점추정

#### (1) 우도함수(Likelihood Function)

$X_1, X_2, \cdots, X_{n-1}, X_n$의 결합확률밀도함수 $f(x1, x_2, \cdots, x_n; \theta)$를 모수 $\theta$에 대한 함수로 볼 때, 이를 우도함수로 정의하며 다음과 같이 표시한다.
$$
L(\theta) = L(x_1, x_2, \cdots, x_n; \theta)
$$
이 때 각 확률변수들이 모두 독립이고 같은 확률분포를 따른다면 우도함수는 다음과 같이 표현 가능하다. 
$$
L(\theta) = f(x_1; \theta)f(x_2;\theta) \cdots f(x_n;\theta) =  \prod_i^n f(x_i; \theta)
$$
<br>

#### (2) 최대우도추정(Maximum Likelihood Estimation)

최대우도란 계산된 우도값 중 가장 큰 값을 의미하며, 즉 우도함수를 통해 계산된 **우도값 중 가장 큰 값을 모수 추정량으로 선택하는 방법**이다.

- 확률표본의 우도함수  $L(X_1, X_2, \cdots, X_n \theta)$를 최대로 하는 $\theta$를 $\hat{\theta}$라고 할 때, $\hat{\theta}$를 모수 $\theta$의 최대우도추정량이라 한다.
- 일반적으로 미분을 통해 극댓값을 찾는 방법으로 최대우도추정량을 구한다.
- 계산의 편의성을 위해 우도함수에 로그를 취한 로그우도함수 $lnL(X_1, X_2, \cdots, X_n;\theta)$를 최대로 하는 $\theta$를 구하는 것이 일반적이다.

<br><br>

## 3. 구간추정

점추정은 모집단의 모수를 하나의 값으로 추정하는 것이기 때문에 아무리 좋은 추정방법을 사용한다고 하더라도 그 추정값이 실제 모수값과 정확히 일치할 수는 없다. 

구간추정(Interval Estimation) 또는 신뢰구간(Confidence Interval) 방법을 사용하면 이러한 문제를 해결할 수 있다.

<br>

### 1) 구간추정의 개념

구간추정이란 **점추정에 오차(error)의 개념을 도입하여 모수가 포한되는 확률변수구간을 어떤 신뢰성 아래 추정하는 것**이다.

#### (1) 일반화

- 구간의 상한을 $\hat{\theta}_h$, 구간의 하한을 $\hat{\theta}_l$라고 할 때, 모수가 있을 것으로 예상되는 구간을 [$\hat{\theta}_l, \hat{\theta}_h$]로 나타내고, 이 때 구간의 크기는 $\hat{\theta}_h - \hat{\theta}_l$이 된다.
- 구간의 크기가 작을수록 실제 모수를 좀 더 정확하게 추정할 수 있으며, 설정한 구간 안에 모수가 들어갈 확률을 구해 확인하는 과정이 필요하다.

<br>

#### (2) 신뢰수준(Confidence Level), 유의수준(Level of significance)

추정한 구간 안에 모수가 들어갈 확률을 아래와 같이 표기할 때,
$$
P(\hat{\theta}_l \leq \theta \leq \hat{\theta}_h) = 1 - \alpha ~~~ (0<\alpha<1)
$$
**$1 - \alpha$, 혹은 $100 \cdot (1-\alpha)\%$ 를 신뢰수준**이라고 하고, **$\alpha$를 유의수준**이라고 한다.

<br>

### 2) 모평균의 구간추정

#### (1) 모집단의 분산을 알고 있는 경우

모집단의 모분산을 $\sigma^2$, 모집단에서 추출한 크기가 n인 확률표본 X의 표본평균을 $\bar{X}$라고 할 때, 모평균 $\mu$에 대해 신뢰수준 $100(1-\alpha)\%$으로 추정한 구간은 다음과 같다.
$$
\bar{X} - Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}} ~ \leq ~ \mu ~ \leq ~ \bar{X} + Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}}
$$
이 때 $Z_{\frac{\alpha}{2}}$ 는 오른쪽 면적이 $\alpha / 2$인 표준정규분포를 따르는 $Z$값이다. 

<br>

#### (2) 모집단의 분산을 모르는 경우

모집단의 표준편차를 모를 때는 표본에서 구한 불편추정량, 즉 **표본의 표준편차를 대신 사용**한다.
$$
S = \sqrt{\frac{1}{n-1}\sum(x_i - \bar{X})^2}
$$
단, 표본의 크기가 작은 경우 **표본통계량은 정규분포를 따르지 않고 자유도 (n-1)인 t-분포를 따르므로, t-분포를 이용해 신뢰구간을 구한다.**
$$
\bar{X} - t_{\frac{\alpha}{2}, n-1}\cdot \frac{S}{\sqrt{n}} ~\leq ~\mu ~\leq~ \bar{X} + t_{\frac{\alpha}{2}, n-1}\cdot \frac{S}{\sqrt{n}}
$$
모집단의 분포가 정규분포를 이루며 표준편차가 알려지지 않은 경우 위와 같이 t-분포를 사용하는 것이 일반적이나, 표본의 크기가 클 때에는 표본의 표준편차와 모집단의 표준편차의 차이가 작기 때문에 Z-통계량을 사용해도 무방하다.

<br>

### 3) 모집단의 신뢰구간

모집단  X가 정규분포를 따를 때, 모집단으로부터 추출한 크기가 n인 확률표본  X의 표본분산을 $S^2$라고 하면, 모분산 $\sigma^2$에 대해 다음이 성립한다.
$$
\frac{(n-1)S^2}{\sigma^2} \sim \chi^2(n-1), ~~~~~ \chi^2(n-1)\text{은 자유도가 } n-1\text{인 } \chi^2\text{분포}
$$
그러면 $100(1-\alpha)\%$인 신뢰구간은
$$
\chi^2_{\frac{\alpha}{2}}(n-1) ~ < ~ \frac{(n-1)S^2}{\sigma^2} ~ < ~ \chi^2_{1 - \frac{\alpha}{2}}(n-1)
$$
이고, 이를 정리하면 다음과 같다.
$$
\frac{(n-1)S^2}{\chi^2_{1 - \frac{\alpha}{2}}(n-1)} ~ < ~ \sigma^2 ~ < ~ \frac{(n-1)S^2}{\chi^2_{\frac{\alpha}{2}}(n-1)}
$$
<br>

### 4) 모비율의 신뢰구간

\* 모비율 예시: 성인 남자의 흡연율

모집단 X가 이항분포 $B(n,p)$를 따르고 n이 충분히 크다고 하면, 모평균 추정 방식과 동일하게 정규분포와 표본비율을 이용해 모비율을 추정할 수 있다.

아래와 같이 모평균 대신 모비율 p , 표본평균 대신 표본비율 $\hat{p}$를 대입해 모비율의 신뢰구간을 구할 수 있다.
$$
\hat{p} - Z_{\frac{\alpha}{2}}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}} ~ < ~ < ~ \hat{p} + Z_{\frac{\alpha}{2}}\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}
$$
<br>

### 5) 신뢰구간 표본 크기의 결정

신뢰구간  $100(1-\alpha)\%$에 대한 모평균의 신뢰구간은 다음과 같다.
$$
\bar{X} - Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}} ~ \leq ~ \mu ~ \leq ~ \bar{X} + Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}}
$$
위 식에서 알 수 있듯 신뢰구간상 허용되는 오차범위는 $ - Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}}$ 에서 $  Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}}$ 사이이고, 한 방향에 대한 허용오차 값 $ Z_{\frac{\alpha}{2}}\cdot \frac{\sigma}{\sqrt{n}}$를  d라고 하고 이를 n 에 대해 정리해보면
$$
n = \left(Z_{\frac{\alpha}{2}} \cdot \frac{\sigma}{d}\right)^2
$$
가 된다.

같은 방식으로 모비율의 신뢰구간 식을 통해 표본크기 n 을 구해보면 다음과 같다.
$$
n = \left(Z_{\frac{\alpha}{2}} \cdot \frac{p(1-p)}{d}\right)^2
$$
*\*이 때, 모비율 p에 대한 정보가 없는 경우 p=1/2로 놓고 표본의 크기를 결정한다.*

<br><br>

## 4. 가설검정

모집단에 대해 설정한 가설을 모집단으로부터 추출한 표본을 분석함으로써 검정하는 통계기법이다. 

- 검정통계량(Test Statistic): 가설검정을 위해 표을 분석할 때 사용되는 표본통계량

<br>

### 1) 가설검정의 절차

#### (1) 가설 설정

- 귀무가설(Null Hypothesis, $H_0$): 통념적으로 믿어지고 있는 모수에 대한 주장 또는 기준이 되는 가설
- 대립가설(Alternative Hypothesis, $H_1$): 모수에 대해 새롭게 통계적으로 입증해내고자 하는 가설

-> 표본 분석을 통해 대립가설을 입증하지 못한다면 귀무가설이 채택된다.

<br>

#### (2) 유의수준 $\alpha$

가설의 채택여부를 결정할 때는 다음 두 가지의 오류가 발생할 수 있다.

- 제 1종 오류: 귀무가설이 참인데도 귀무가설이 기각되는 경우
- 제 2종 오류: 귀무가설이 거짓인데 귀무가설이 채택되는 경우

제 1종 오류는 특정 피고인이 무죄이나 유죄라고 선언되는 경우와 같기 때문에 더욱 중대한 오류이다. 따라서 제1종 오류를 범할 확률의 최대 허용한계를 설정하여 가설의 채택 기준으로 삼아야 하는데, 이 기준을 유의수준(Significance Level)이라고 한다.

**유의수준 $\alpha$는 표본에서 얻은 표본통계량이 기각역(rejection region)에 들어갈 확률, 즉 귀무가설이 참인데도 귀무가설이 기각될 확률**을 말하며, 일반적으로 1%, 5%, 10% 등이 많이 활용된다.

계산된 유의수준(p-value)이 낮을수록 귀무가설을 기각하고 대립가설을 채택하는 것에 대해 확신을 가질 수 있다.

> ex) p-value가 0.07인 경우, 귀무가설을 기각했을 때 그 선택이 틀렸을 확률이 0.07인 것이다.

귀무가설의 기각 여부는  p-value와 $\alpha$의 크기에 달려있다. p-value가 작을수록, $\alpha$값이 클수록 귀무가설을 기각할 수 있다. 

<br>

### 2) 검정통계량 및 표본분포의 결정

유의수준에 따른 귀무가설의 기각역을 결정하기 위해 귀무가설이 참일 때 검정통계량의 확률분포를 알아야 하며, 알려져있지 않을 때에는 통계학의 중심극한정리에 근거해 근사적인 분포를 정해야 한다.

<br>

### 3) 기각역의 결정

표본에서 계산된 검정통계량이 가설로 설정한 모집단의 성격과 현저한 차이가 있을 경우 모집단에 대해 설정한 귀무가설을 기각하게 된다.

이 때 **귀무가설을 기각하게 되는 검정통계량의 범위를 기각역(Critical Region, Rejection Region)**이라고 하며, **기각역의 경계값을 임계치(Critical Value)**라고 한다.

기각역은 귀무가설이 참일 때  검정통계량의 확률분포와 유의수준 $\alpha$와 대립가설의 형태에 따라 단측 혹은 양측 검정통계량이 설정된다.

- 양측 검정: 기각영역이 양쪽에 있는 경우
- 단측 검정: 기각영역이 어느 한쪽에만 있는 경우

<br>

### 4) 표본의 평균 검정

단일 표본에서 모평균에 대한 검정은 표본평균 $\bar{X}$를 이용한다.

모집단이 정규분포를 따르거나 표본수가 많은 경우 Z-검정을 사용하며, 모집단이 정규분포를 따르면서 표본 수가 적은 경우  t-검정을 이용한다.

> ex) 어느 고등학교 학생들의 용돈 수준을 조사하려고 한다.
>
> 16명의 학생을 표본으로 조사하였더니, 한달 평균 용돈이 96,000원이었다. 그 학교 학생 전체의 한 달 용돈 표준편차가 6,000원일 때, 그 학교 학생들의 한 달 평균 용돈이 월 100,000원 이상이라고 할 수 있는지 유의수준 5%로 검정하라.
> $$
> \text{가설}~~ H_0: \mu \geq 100,000, ~~ H_1 : \mu < 100,000\\
> \text{유의수준}~~\alpha=5\%\\
> $$
> 유의수준 5%를 Z 정규화했을 때 표준정규분표표에 따라 채택영역은 $Z \geq -1.64$, 기각영역은 $Z \leq -1.64$가 된다.
> $$
> Z = \frac{\bar{X} - \mu}{\sigma/\sqrt{n}} = \frac{96000 - 100000}{6000/\sqrt{16}} = -\frac{4000}{1500} = -2.67
> $$
> 이 값은 -1.64보다 작기 때문에 이 학교 학생의 한달 용돈 평균이 10만원이 된다고 볼 수 없다.

<br>